<h1 id="一所用ubuntu及虚拟机版本">一、所用ubuntu及虚拟机版本</h1>
<p>之前还尝试了在docker下安装，但是出现很多奇奇怪怪的错误，所以放弃了，直接选择在虚机下安装</p>
<h2 id="版本">版本</h2>
<p>电脑：MacBook Pro</p>
<p>虚拟机：VirtualBox 7.1.8</p>
<p>linux 版本：ubuntu 20.04.6</p>
<h2 id="虚拟机配置">虚拟机配置</h2>
<p>内存：8192M</p>
<p>硬盘：50G</p>
<p>处理器：4</p>
<h2 id="资源分享">资源分享</h2>
<p><code>bochs-2.6.tar.gz</code>在下面的夸克网盘中：</p>
<pre><code>我用夸克网盘给你分享了「share_tinyOS」，点击链接或复制整段内容，打开「夸克APP」即可获取。
/~9c4837w2hG~:/
链接：https://pan.quark.cn/s/335eca91431f
提取码：4JT8</code></pre>
<h1 id="二bochs模拟器配置">二、bochs模拟器配置</h1>
<p>首先用该链接下载<a
href="https://sourceforge.net/projects/bochs/files/bochs/2.6.8/bochs-2.6.8.tar.gz/download">bochs-2.6.tar.gz</a></p>
<p>先解压：tar -zxvf bochs-2.6.tar.gz</p>
<p><img src="1 Ubuntu中解压.png"></p>
<p><img src="2 Ubuntu中解压结果.png"></p>
<p><img src="3 config路径.png"></p>
<p>终端cd
到<code>bochs-2.6</code>文件夹中，执行<code>./configure</code>进行config，其中<code>--prefix=</code>后面路径中的<code>akira</code>修改为自己的用户名</p>
<pre><code>./configure \
  --prefix=/home/akira/bochs \
  --enable-debugger \
  --enable-disasm \
  --enable-iodebug \
  --enable-x86-debugger \
  --with-x \
  --with-x11 \
  LDFLAGS=&quot;-lpthread&quot;</code></pre>
<ul>
<li><p>第一个报错解决：<code>sudo apt-get -y install gcc</code>，解决方案是装一个编译器</p>
<p><img src="5 第一个报错&解决指令.png"></p></li>
<li><p>第二个报错解决：<code>sudo apt-get install build-essential</code></p>
<p><img src="5 第二个报错&解决指令.png"></p></li>
</ul>
<p>执行<code>make</code>和<code>make install</code></p>
<ul>
<li><p>出现报错，解决方法为：<code>sudo apt-get install -y libgtk2.0-dev</code>，然后重新执行<code>./configure</code>和<code>make</code></p>
<p><img src="6 make第一个报错&解决指令.png"></p></li>
</ul>
<p>成功执行完<code>make</code>和<code>make install</code>后，生成<code>bochs</code>文件夹，该文件夹下可以进行我们的内核编写、内核编译运行、起虚拟机等一系列学习操作。</p>
<h1 id="三运行bochs">三、运行bochs</h1>
<h2 id="配置bochsrc.disk">1. 配置<code>bochsrc.disk</code></h2>
<p>由于<code>boxsrc.disk</code>文件需要用到下面生成的镜像文件路径，因此将该配置放在<a
href="#附录-bochs配置文件说明">附录中</a></p>
<h2 id="运行bochs无启动盘">2. 运行bochs：无启动盘</h2>
<p>在<code>bochs</code>路径下执行<code>bin/bochs</code>：</p>
<p><img src="8 运行bochs生成窗口.png"></p>
<p>之后输入<code>c</code>进入模拟器，但是显示没有启动盘。</p>
<p><img src="9 运行bochs输入c.png"></p>
<p>Bochs 启动时会读取配置文件（通常是 bochsrc），其中指定了启动盘（boot
drive）镜像的位置。如果没有正确配置或指定的镜像文件不存在，就会出现<strong>没有启动盘</strong>的问题。</p>
<p><img src="10 运行bochs没有bootable.png"></p>
<p>因此需要用 <code>bximage</code> 创建 <code>.img</code> 镜像并正确配置
<code>bochsrc</code>。</p>
<h2 id="创建虚拟盘">3. 创建虚拟盘</h2>
<p><code>bin/bximage</code>
是一个虚拟磁盘镜像生成工具，生成的虚拟磁盘后缀名为<code>.img</code>，下面我们将运行<code>bin/bximage</code>
创建一个虚拟磁盘镜像，根据运行后的指引一步步生成master镜像：</p>
<p><img src="11 bximage根据指引一步步生成master镜像.png"></p>
<p>创建成功后，在<code>bin</code>目录下生成了<code>master-hd60M.img</code>，创建完并修改配置文件<code>bochsrc.disk</code>，将虚拟的镜像硬盘文件的路径添加进去，再次启动模拟器：</p>
<p><img src="12 运行启动盘配置后.png"></p>
<p>此时只有master盘，还是无法读取盘，但是报错内容跟未加磁盘前不一样了：</p>
<p>上一个报错截图中shell的报错内容是<code>Boot failed:could not read the boot disk</code></p>
<p>而此次报错截图内容是<code>Boot failed:not a bootable device</code></p>
<h2 id="编写mbr文件作为master的主引导程序">4.
编写MBR文件作为master的主引导程序</h2>
<p>具体操作见文档另一篇博文<a href=""></a></p>
<h1 id="四ubuntu设置开启ssh">四、ubuntu设置开启ssh</h1>
<blockquote>
<p>参考：<a
href="https://blog.csdn.net/qq_45164331/article/details/122533327">ubuntu20.04开启SSH远程登录</a></p>
</blockquote>
<blockquote>
<p>参考：<a
href="https://zhuanlan.zhihu.com/p/442884471">Windows下VSCode连接Ubuntu远程开发</a>、<a
href="https://zhuanlan.zhihu.com/p/143146239">mac下vscode连接ssh</a></p>
</blockquote>
<p>本机写得ssh config文件：</p>
<div class="sourceCode" id="cb3"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="ex">Host</span> 172.16.33.128</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="ex">HostName</span> 172.16.33.128</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="ex">User</span> akira</span></code></pre></div>
<p><img src="13 ssh的IP.png"></p>
<p>连接ssh需要先把本机的代理关了，解决办法是：</p>
<h2 id="附录-bochs配置文件说明">附录-bochs配置文件说明</h2>
<p>在<code>./bochs/</code>路径下创建<code>bochsrc.disk</code>文件：</p>
<pre><code>vim bochs.disk   #创建配置文件(配置文件存放位置和文件名可以随意)

######################  配置文件开始 ####################
#第一步，首先设置bochs在运行过程中能够使用的内存，本例为32MB
#关键字为：megs

megs: 32

#第二步，设置对应真实机器的BIOS和VGA BIOS
#对应两个关键字为: romimage 和vgaromiage

romimage: file=/实际路径/bochs/share/bochs/BIOS-bochs-latest
vgaromimage: file=/实际路径/bochs/share/bochs/VGABIOS-lgpl-latest

#第三步，选择启动盘符
boot: disk        #从硬盘启动

#第四步，设置日志文件的输出
log: bochs.out

#第五步，开启或关闭某些功能
#下面是关闭鼠标，并打开键盘
mouse: enabled=0
keyboard_mapping: enabled=1,map=/实际路径/bochs/share/bochs/keymaps/x11-pc-us.map

#硬盘设置
ata0: enabled=1, ioaddr1=0x1f0, ioaddr2=0x3f0, irq=14
ata0-master: type=disk, path=&quot;hd60m.img&quot;, mode=flat, cylinders=121, heads=16, spt=63
######################  配置文件结束 ####################</code></pre>
<p>最后，以本人为例，编写的<code>disk</code>文件如下：</p>
<pre><code>megs : 32

romimage: file=/home/akira/bochs/share/bochs/BIOS-bochs-latest
vgaromimage: file=/home/akira/bochs/share/bochs/VGABIOS-lgpl-latest

boot: disk

log: bochs.out

mouse:enabled=0
keyboard:keymap=/home/akira/bochs/share/bochs/keymaps/x11-pc-us.map

ata0:enabled=1,ioaddr1=0x1f0,ioaddr2=0x3f0,irq=14
ata0-master: type=disk, path=&quot;master-hd60M.img&quot;, mode=flat,cylinders=121,heads=16,spt=63
#ata0-slave:  type=disk, path=&quot;hd80M.img&quot;, mode=flat,cylinders=162,heads=16,spt=63

#gdbstub:enabled=1,port=1234,text_base=0,data_base=0,bss_base=0</code></pre>
<h1 id="问题处理">问题处理</h1>
<ol type="1">
<li><p>无法打开终端，一直转圈</p>
<p>解决方法：<a
href="https://www.cnblogs.com/lifuqiang/articles/17167367.html">VirtualBox_Ubuntu22.04
Terminal无法打开</a>，其中nano用Ctrl+X 保存并退出</p></li>
<li><p>找不到root密码</p>
<p>解决办法：在刚开始创建虚拟机时就输入密码了，当前密码为akira</p></li>
<li><p>virtualbox共享文件</p>
<p>解决办法：1）<a
href="https://zhuanlan.zhihu.com/p/25148068">安装VBoxGuestAdditions</a>
2）<a
href="https://docs.pingcode.com/baike/3244459">打开拖放功能</a></p></li>
</ol>
<h1 id="参考">参考</h1>
<blockquote>
<p>《操作系统真象还原》</p>
</blockquote>
<blockquote>
<p><a
href="https://github.com/Cooi-Boi/Tiny-OS?tab=readme-ov-file">Tiny-OS的项目介绍:大佬的github学习仓以及他的csdn学习笔记链接</a></p>
</blockquote>
